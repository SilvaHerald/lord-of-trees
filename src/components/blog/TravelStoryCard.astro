---
import { convertDateToLanguageFormat, defaultLang, removeLanguagePrefix, useTranslations, type Language } from '@libs/i18n/config';
import type { CollectionEntry } from 'astro:content';

export interface Props {
  post: CollectionEntry<'posts'>;
  featured?: boolean;
  large?: boolean;
  class?: string;
  lang?: Language;
}


const { post, featured = false, large = false, class: className = '', lang = 'en' } = Astro.props;

const t = useTranslations(lang as Language);

// Calculate reading time (rough estimate)
const readingTime = Math.ceil(post.body.length / 1000);

const travelPostUrl = `${lang === defaultLang ? '' : '/' + lang}/stories${removeLanguagePrefix(post.slug)}`;
---

<article
  class={`group bg-white dark:bg-slate-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 border border-slate-200 dark:border-slate-700 ${className} ${large ? 'row-span-2' : ''}`}
>
  {
    post.data.coverImage && (
      <div class={`relative overflow-hidden ${large ? 'aspect-[4/3]' : 'aspect-video'}`}>
        <img
          src={post.data.coverImage}
          alt={post.data.title}
          class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-110"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent" />

        {/* Travel type badge */}
        {post.data.tripType && (
          <div class="absolute top-4 left-4">
            <span class="inline-flex items-center rounded-full bg-black/30 px-3 py-1 text-xs font-medium text-white backdrop-blur-sm">
              {t(`tripType.${post.data.tripType}`)}
            </span>
          </div>
        )}

        {/* Reading time */}
        <div class="absolute top-4 right-4">
          <span class="inline-flex items-center rounded-full bg-black/30 px-3 py-1 text-xs font-medium text-white backdrop-blur-sm">
            <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            {readingTime} {t('post.readingTime')}
          </span>
        </div>

        {/* Destinations overlay */}
        {post.data.destinations && post.data.destinations.length > 0 && (
          <div class="absolute right-4 bottom-4 left-4">
            <div class="flex flex-wrap gap-2">
              {post.data.destinations.slice(0, 2).map(destination => (
                <span class="inline-flex items-center rounded-md bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm">
                  <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                  {destination}
                </span>
              ))}
              {post.data.destinations.length > 2 && (
                <span class="inline-flex items-center rounded-md bg-black/40 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm">
                  +{post.data.destinations.length - 2} {t('post.destinations.more')}
                </span>
              )}
            </div>
          </div>
        )}
      </div>
    )
  }

  <div class={`p-6 ${large ? 'p-8' : ''}`}>
    <h3
      class={`font-bold text-slate-900 dark:text-white mb-3 group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors line-clamp-2 ${featured && large ? 'text-2xl' : featured ? 'text-xl' : 'text-lg'}`}
    >
      <a href={travelPostUrl}>
        {post.data.title}
      </a>
    </h3>

    <p
      class={`text-slate-600 dark:text-slate-300 mb-4 line-clamp-3 ${large ? 'text-base' : 'text-sm'}`}
    >
      {post.data.description}
    </p>

    {/* Travel details */}
    <div class="mb-4 flex flex-wrap items-center gap-4 text-xs text-slate-500 dark:text-slate-400">
      <time datetime={post.data.publishDate.toISOString()} class="flex items-center">
        <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
          ></path>
        </svg>
        {
          convertDateToLanguageFormat(post.data.publishDate, lang)
        }
      </time>

      {
        post.data.duration && (
          <span class="flex items-center">
            <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            {post.data.duration}
          </span>
        )
      }
    </div>

    {/* Countries visited */}
    {
      post.data.countries && post.data.countries.length > 0 && (
        <div class="flex items-center text-xs font-medium text-amber-600 dark:text-amber-400">
          <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"
            />
          </svg>
          {post.data.countries.join(', ')}
        </div>
      )
    }
  </div>
</article>
