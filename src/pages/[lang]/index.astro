---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/BaseLayout.astro';
import TravelStoryCard from '@components/blog/TravelStoryCard.astro';
import TravelSearchBar from '@components/blog/TravelSearchBar.astro';
import DestinationFilter from '@components/blog/DestinationFilter.astro';
import TravelStats from '@components/blog/TravelStats.astro';
import { languages, useTranslations, type Language } from '@libs/i18n/config';
import { getImageUrl } from '@utils/image';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');

  return Object.keys(languages).flatMap(lang => {
    const langPosts = allPosts.filter(post => post.data.lang === lang);

    return {
      params: { lang },
      props: { posts: langPosts },
    };
  });
}

const { lang } = Astro.params;
const {posts: allPosts} = Astro.props;

const t = useTranslations(lang as Language);

// Get all blog posts and sort by date
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

// Get unique destinations/countries
const allDestinations = [...new Set(publishedPosts.flatMap(post => post.data.destinations.map(dest => dest.name)))];
const allCountries = [...new Set(publishedPosts.map(post => post.data.country))];

// Get featured travel stories
const featuredStories = publishedPosts.filter(post => post.data.featured).slice(0, 2);
const recentAdventures = publishedPosts.slice(0, 6);

// Calculate travel stats
const totalCountries = allCountries.length;
const totalDestinations = allDestinations.length;
const totalStories = publishedPosts.length;
---

<BaseLayout title={t('home.pageTitle')} description={'home.pageDescription'} lang={lang as Language}>
  <main
    class="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"
  >
    <!-- Hero Section -->
    <section class="relative overflow-hidden">
      <!-- Background Image -->
      <div class="absolute inset-0 z-0">
        <img
          src={getImageUrl('/demo/travel-hero-bg.jpg')}
          alt="Travel background"
          class="h-full w-full object-cover opacity-50 dark:opacity-50"
        />
        <div
          class="absolute inset-0 bg-gradient-to-br from-amber-500/20 via-orange-500/20 to-red-500/20 dark:from-slate-900/40 dark:to-slate-800/40"
        >
        </div>
      </div>

      <div class="relative z-10 mx-auto max-w-7xl px-4 py-20 sm:px-6 md:py-32 lg:px-8">
        <div class="text-center">
          <!-- Travel Icon -->
          <div class="mb-6 flex justify-center">
            <div
              class="rounded-full bg-white/90 p-4 shadow-lg backdrop-blur-sm dark:bg-slate-800/90"
            >
              <svg
                class="h-12 w-12 text-amber-600 dark:text-amber-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"
                ></path>
              </svg>
            </div>
          </div>

          <h1
            class="mb-6 text-4xl font-bold text-balance text-slate-900 md:text-6xl lg:text-7xl dark:text-white"
          >
            {t('hero.title').split(' ')[0]}
            <span
              class="bg-gradient-to-r from-amber-600 via-orange-600 to-red-600 bg-clip-text text-transparent"
              >{t('hero.title').split(' ').slice(1).join(' ')}
            </span>
          </h1>

          <p
            class="mx-auto mb-8 max-w-3xl text-xl text-balance text-slate-700 md:text-2xl dark:text-slate-300"
          >
            {t('hero.subtitle')}
          </p>

          <!-- Travel Stats -->
          <TravelStats
            lang={lang as Language}
            countries={totalCountries}
            destinations={totalDestinations}
            stories={totalStories}
          />

          <!-- Search & Filter -->
          <div
            class="mx-auto mt-12 flex max-w-2xl flex-col items-center justify-center gap-4 lg:flex-row"
          >
            <TravelSearchBar lang={lang as Language} />
            <DestinationFilter
              lang={lang as Language}
              destinations={allDestinations}
              countries={allCountries}
            />
          </div>
        </div>
      </div>
    </section>

    <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
      <!-- Featured Stories -->
      {
        featuredStories.length > 0 && (
          <section class="mb-20">
            <div class="mb-12 text-center">
              <h2 class="mb-4 text-3xl font-bold text-slate-900 md:text-4xl dark:text-white">
                {t('featured.title')}
              </h2>
              <p class="mx-auto max-w-2xl text-lg text-slate-600 dark:text-slate-400">
                {t('featured.subtitle')}
              </p>
            </div>

            <div class="grid gap-8 lg:grid-cols-2">
              {featuredStories.map((story, index) => (
                <TravelStoryCard
                  post={story}
                  featured={true}
                  large={index === 0}
                  class="transform transition-all duration-300 hover:scale-102"
                  lang={lang as Language}
                />
              ))}
            </div>
          </section>
        )
      }

      <!-- Recent Adventures -->
      <section class="mb-20">
        <div
          class="mb-12 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center"
        >
          <div>
            <h2 class="mb-2 text-3xl font-bold text-slate-900 md:text-4xl dark:text-white">
              {t('recent.title')}
            </h2>
            <p class="text-lg text-slate-600 dark:text-slate-400">
              {t('recent.title')}
            </p>
          </div>

          <div class="flex gap-2">
            <button
              class="rounded-full border border-slate-300 bg-white/80 px-4 py-2 text-sm font-medium text-slate-700 backdrop-blur-sm transition-colors hover:bg-amber-50 dark:border-slate-600 dark:bg-slate-800/80 dark:text-slate-300 dark:hover:bg-slate-700"
            >
              {t('filter.latest')}
            </button>
            <button
              class="rounded-full border border-slate-300 bg-white/80 px-4 py-2 text-sm font-medium text-slate-700 backdrop-blur-sm transition-colors hover:bg-amber-50 dark:border-slate-600 dark:bg-slate-800/80 dark:text-slate-300 dark:hover:bg-slate-700"
            >
              {t('filter.popular')}
            </button>
            <button
              class="rounded-full border border-slate-300 bg-white/80 px-4 py-2 text-sm font-medium text-slate-700 backdrop-blur-sm transition-colors hover:bg-amber-50 dark:border-slate-600 dark:bg-slate-800/80 dark:text-slate-300 dark:hover:bg-slate-700"
            >
              {t('filter.photos')}
            </button>
          </div>
        </div>

        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {recentAdventures.map(story => <TravelStoryCard lang={lang as Language} post={story} />)}
        </div>
      </section>

      <!-- Load More Button -->
      {
        publishedPosts.length > 6 && (
          <div class="mb-20 text-center">
            <button
              class="inline-flex transform items-center rounded-full bg-gradient-to-r from-amber-600 to-orange-600 px-8 py-4 text-base font-medium text-white shadow-lg transition-all duration-200 hover:scale-105 hover:from-amber-700 hover:to-orange-700 hover:shadow-xl"
              id="load-more"
            >
              {t('load.more')}
              <svg class="ml-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 8l4 4m0 0l-4 4m4-4H3"
                />
              </svg>
            </button>
          </div>
        )
      }

      <!-- Newsletter & Community -->
      <section class="relative overflow-hidden rounded-3xl">
        <div class="absolute inset-0 bg-gradient-to-br from-amber-600 via-orange-600 to-red-600">
        </div>
        <!-- <div class="absolute inset-0 bg-[url('/images/travel-pattern.svg')] opacity-10"></div> -->

        <div class="relative p-8 text-center text-white md:p-16">
          <div class="mx-auto max-w-3xl">
            <div class="mb-6 flex justify-center">
              <div class="rounded-full bg-white/20 p-3 backdrop-blur-sm">
                <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  ></path>
                </svg>
              </div>
            </div>

            <h3 class="mb-4 text-3xl font-bold md:text-4xl">{t('newsletter.title')}</h3>
            <p class="mb-8 text-xl text-balance text-orange-100 md:text-2xl">
              {t('newsletter.subtitle')}
            </p>

            <form class="mx-auto flex max-w-lg flex-col gap-4 sm:flex-row">
              <input
                type="email"
                placeholder={t('newsletter.email')}
                class="flex-1 rounded-full border-1 border-amber-400 px-6 py-4 text-slate-100 placeholder-slate-200 backdrop-blur-sm focus:border-orange-600 focus:ring-4 focus:ring-white/20 focus:outline-none"
                required
              />
              <button
                type="submit"
                class="rounded-full bg-white px-8 py-4 font-semibold text-orange-600 shadow-lg transition-colors hover:bg-orange-50 focus:ring-4 focus:ring-white/20 focus:outline-none"
              >
                {t('newsletter.button')}
              </button>
            </form>

            <p class="mt-6 text-sm text-orange-200">
              {t('newsletter.note')}
            </p>
          </div>
        </div>
      </section>
    </div>
  </main>
</BaseLayout>

<script>
  // Add interactivity for load more button
  document.addEventListener('DOMContentLoaded', () => {
    const loadMoreBtn = document.getElementById('load-more');

    if (loadMoreBtn) {
      loadMoreBtn.addEventListener('click', () => {
        // This would typically load more posts via API
        console.log('Loading more travel stories...');
      });
    }
  });
</script>
